CREATE TABLE users (
    id INT IDENTITY (1, 1) NOT NULL,
    created_at DATETIMEOFFSET NOT NULL,
    updated_at DATETIMEOFFSET NOT NULL,
    PRIMARY KEY (id)
);

INSERT INTO users (created_at, updated_at)
VALUES ('2023-04-12 12:00:00 +03:00', '2023-04-12 12:00:00 +03:00');


CREATE TABLE users_social_profiles (
    id INT IDENTITY (1, 1) NOT NULL,
    user_id INT NOT NULL,
    provider VARCHAR(20) CHECK (
        provider IN(
            'github',-----    -- developers       -- use      -- email = true
            'gitlab',-----    -- developers       -- use      -- email = true
            'bitbucket',--    -- developers       -- use      -- email = true
            'figma',------    -- designers        -- @todo
            'dribbble',---    -- designers        -- use      -- email = false
            'behance',----    -- designers        -- none provider
            'linkedin',---    -- business         -- use      -- email = true
            'xing',-------    -- business         -- @todo
            'google'------    -- global           -- use      -- email = true
         )) NOT NULL,
    social_id VARCHAR(50) NOT NULL,
    email VARCHAR(50) NOT NULL,
    username VARCHAR(50) NOT NULL,
    created_at DATETIMEOFFSET NOT NULL,
    updated_at DATETIMEOFFSET NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (user_id) REFERENCES users (id)
);

CREATE INDEX EMAIL_INDEX ON users_social_profiles (email);
CREATE UNIQUE INDEX PROVIDER_SOCIAL_UNIQUE ON users_social_profiles (provider, social_id);

INSERT INTO users_social_profiles (
    user_id,
    provider,
    social_id,
    email,
    username,
    created_at,
    updated_at
)
VALUES (1, 'google', 12345, 'test@email.com', 'Name Username', '2023-04-12 12:00:00 +03:00', '2023-04-12 12:00:00 +03:00');


CREATE TABLE urls (
    id INT IDENTITY (1, 1) NOT NULL,
    original_url TEXT NOT NULL,
    short_url VARCHAR(10) NOT NULL,
    secret_access_token uniqueidentifier NOT NULL,
    created_at DATETIMEOFFSET NOT NULL,
    updated_at DATETIMEOFFSET,
    deleted_at DATETIMEOFFSET,
    created_by INT,
    PRIMARY KEY (id),
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE NO ACTION
);

INSERT INTO urls (
        original_url,
        short_url,
        secret_access_token,
        created_at,
        created_by
    )
VALUES ('https://fastapi.tiangolo.com/', '12345', 'a8098c1a-f86e-11da-bd1a-00112444be1e', '2023-04-12 12:00:00 +03:00',  1),
    ('https://plotly.com/graphing-libraries/', '54321', 'a8098c1a-f86e-11da-bd1a-00112444be2e', '2023-04-12 12:00:00 +03:00', 1),
    ('https://docs.pydantic.dev/', 'qwert', 'a8098c1a-f86e-11da-bd1a-00112444be3e', '2023-04-12 12:00:00 +03:00', 1);

CREATE TABLE prohibited_domain (
    id INT IDENTITY (1, 1) NOT NULL,
    name TEXT NOT NULL,
    PRIMARY KEY (id)
);

INSERT INTO prohibited_domain (name)
VALUES ('www.google.com'),
    ('www.facebook.com'),
    ('tsn.ua');

CREATE TABLE hour_views (
    url_id INT NOT NULL,
    hour_time DATETIMEOFFSET NOT NULL,
    count INT NOT NULL DEFAULT 1,
    PRIMARY KEY (url_id, hour_time)
);

INSERT INTO hour_views (url_id, hour_time, count)
VALUES ('1', '2023-03-01 19:00:00 +03:00', '1'),
    ('1', '2023-03-02 19:00:00 +03:00', '1'),
    ('1', '2023-03-03 19:00:00 +03:00', '2'),
    ('1', '2023-03-04 19:00:00 +03:00', '2'),
    ('1', '2023-03-05 19:00:00 +03:00', '1'),
    ('1', '2023-03-06 19:00:00 +03:00', '1'),
    ('1', '2023-03-07 19:00:00 +03:00', '2'),
    ('1', '2023-03-07 20:00:00 +03:00', '1'),
    ('1', '2023-03-07 21:00:00 +03:00', '1'),
    ('1', '2023-03-07 22:00:00 +03:00', '1'),
    ('1', '2023-03-08 10:00:00 +03:00', '1'),
    ('1', '2023-03-08 11:00:00 +03:00', '1'),
    ('1', '2023-03-08 12:00:00 +03:00', '1'),
    ('1', '2023-03-08 13:00:00 +03:00', '1'),
    ('1', '2023-03-08 14:00:00 +03:00', '1'),
    ('1', '2023-03-13 10:00:00 +03:00', '1'),
    ('1', '2023-03-13 11:00:00 +03:00', '1'),
    ('1', '2023-03-13 12:00:00 +03:00', '1'),
    ('1', '2023-03-14 13:00:00 +03:00', '1'),
    ('1', '2023-03-15 14:00:00 +03:00', '1'),
    ('1', '2023-03-16 10:00:00 +03:00', '1'),
    ('1', '2023-03-16 11:00:00 +03:00', '1'),
    ('1', '2023-03-16 12:00:00 +03:00', '1'),
    ('1', '2023-03-16 13:00:00 +03:00', '1'),
    ('1', '2023-03-16 14:00:00 +03:00', '1'),
    ('1', '2023-03-17 12:00:00 +03:00', '1'),
    ('1', '2023-03-18 13:00:00 +03:00', '1'),
    ('1', '2023-03-19 14:00:00 +03:00', '1'),
    ('1', '2023-03-20 14:00:00 +03:00', '2'),
    ('1', '2023-03-21 14:00:00 +03:00', '1'),
    ('1', '2023-03-22 14:00:00 +03:00', '1'),
    ('1', '2023-03-23 14:00:00 +03:00', '1'),
    ('1', '2023-03-24 14:00:00 +03:00', '1'),
    ('1', '2023-03-25 14:00:00 +03:00', '1'),
    ('1', '2023-03-26 14:00:00 +03:00', '1'),
    ('1', '2023-03-26 15:00:00 +03:00', '1'),
    ('1', '2023-03-26 16:00:00 +03:00', '1'),
    ('1', '2023-03-26 17:00:00 +03:00', '1'),
    ('1', '2023-03-27 14:00:00 +03:00', '1'),
    ('1', '2023-03-27 15:00:00 +03:00', '1'),
    ('1', '2023-03-27 16:00:00 +03:00', '1'),
    ('1', '2023-03-27 17:00:00 +03:00', '1'),
    ('1', '2023-03-27 18:00:00 +03:00', '1'),
    ('1', '2023-03-27 19:00:00 +03:00', '1'),
    ('1', '2023-03-27 20:00:00 +03:00', '1'),
    ('1', '2023-03-27 21:00:00 +03:00', '5'),
    ('1', '2023-03-27 22:00:00 +03:00', '4'),
    ('1', '2023-03-28 15:00:00 +03:00', '1'),
    ('1', '2023-03-28 16:00:00 +03:00', '1'),
    ('1', '2023-03-29 17:00:00 +03:00', '1'),
    ('1', '2023-03-29 18:00:00 +03:00', '1'),
    ('1', '2023-03-29 19:00:00 +03:00', '1'),
    ('1', '2023-03-30 11:00:00 +03:00', '1'),
    ('1', '2023-03-31 11:00:00 +03:00', '4'),
    ('2', '2023-03-01 19:00:00 +03:00', '2'),
    ('3', '2023-03-02 19:00:00 +03:00', '2'),
    ('2', '2023-03-03 19:00:00 +03:00', '5'),
    ('3', '2023-03-04 19:00:00 +03:00', '5'),
    ('2', '2023-03-05 19:00:00 +03:00', '2'),
    ('3', '2023-03-06 19:00:00 +03:00', '2'),
    ('2', '2023-03-07 19:00:00 +03:00', '6'),
    ('3', '2023-03-07 20:00:00 +03:00', '3'),
    ('2', '2023-03-07 21:00:00 +03:00', '3'),
    ('3', '2023-03-07 22:00:00 +03:00', '2'),
    ('2', '2023-03-08 10:00:00 +03:00', '3'),
    ('3', '2023-03-08 11:00:00 +03:00', '2'),
    ('2', '2023-03-08 12:00:00 +03:00', '3'),
    ('3', '2023-03-08 13:00:00 +03:00', '2'),
    ('2', '2023-03-08 14:00:00 +03:00', '3'),
    ('3', '2023-03-13 10:00:00 +03:00', '2'),
    ('2', '2023-03-13 11:00:00 +03:00', '3'),
    ('3', '2023-03-13 12:00:00 +03:00', '2'),
    ('2', '2023-03-14 13:00:00 +03:00', '3'),
    ('3', '2023-03-15 14:00:00 +03:00', '2'),
    ('2', '2023-03-16 10:00:00 +03:00', '3'),
    ('3', '2023-03-16 11:00:00 +03:00', '2'),
    ('2', '2023-03-16 12:00:00 +03:00', '3'),
    ('3', '2023-03-16 13:00:00 +03:00', '2'),
    ('2', '2023-03-16 14:00:00 +03:00', '3'),
    ('3', '2023-03-17 12:00:00 +03:00', '3'),
    ('2', '2023-03-18 13:00:00 +03:00', '3'),
    ('3', '2023-03-19 14:00:00 +03:00', '3'),
    ('2', '2023-03-20 14:00:00 +03:00', '5'),
    ('3', '2023-03-21 14:00:00 +03:00', '2'),
    ('2', '2023-03-22 14:00:00 +03:00', '2'),
    ('3', '2023-03-23 14:00:00 +03:00', '2'),
    ('2', '2023-03-24 14:00:00 +03:00', '3'),
    ('3', '2023-03-25 14:00:00 +03:00', '3'),
    ('2', '2023-03-26 14:00:00 +03:00', '3'),
    ('3', '2023-03-26 15:00:00 +03:00', '2'),
    ('2', '2023-03-26 16:00:00 +03:00', '2'),
    ('3', '2023-03-26 17:00:00 +03:00', '2'),
    ('2', '2023-03-27 14:00:00 +03:00', '2'),
    ('3', '2023-03-27 15:00:00 +03:00', '2'),
    ('2', '2023-03-27 16:00:00 +03:00', '3'),
    ('3', '2023-03-27 17:00:00 +03:00', '2'),
    ('2', '2023-03-27 18:00:00 +03:00', '2'),
    ('3', '2023-03-27 19:00:00 +03:00', '2'),
    ('2', '2023-03-27 20:00:00 +03:00', '2'),
    ('3', '2023-03-27 21:00:00 +03:00', '12'),
    ('2', '2023-03-27 22:00:00 +03:00', '12'),
    ('3', '2023-03-28 15:00:00 +03:00', '3'),
    ('2', '2023-03-28 16:00:00 +03:00', '3'),
    ('2', '2023-03-29 17:00:00 +03:00', '3'),
    ('2', '2023-03-29 18:00:00 +03:00', '2'),
    ('2', '2023-03-29 19:00:00 +03:00', '2'),
    ('2', '2023-03-30 11:00:00 +03:00', '2'),
    ('3', '2023-03-31 11:00:00 +03:00', '10');